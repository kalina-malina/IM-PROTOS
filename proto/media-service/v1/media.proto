syntax = "proto3";

package media.v1;

option go_package = "gitlab.kalina-tech.ru/backend/media-service/api/gen/media/v1;mediav1";


service MediaService {

  //№№№№№загрузка одного изображения без прьевью
  rpc UploadImage(UploadImageRequest) returns (UploadImageResponse);
  
  // пакетная загрузка изображений
  rpc UploadImages(UploadImagesRequest) returns (UploadImagesResponse);
  
  // удаление медиа
  rpc DeleteMedia(DeleteMediaRequest) returns (DeleteMediaResponse);
  
  // пакетное удаление
  rpc DeleteMediaBatch(DeleteMediaBatchRequest) returns (DeleteMediaBatchResponse);
  
  // получение медиа по id
  rpc GetMedia(GetMediaRequest) returns (GetMediaResponse);
  
  // получение медиа по entity
  rpc GetMediaByEntity(GetMediaByEntityRequest) returns (GetMediaByEntityResponse);
}


message UploadImageRequest {
  MediaType type = 1;          
  string entity_id = 2; 
  bool is_thumbnail = 3; // делать ли превью      
  bytes data = 4;  
}

message UploadImageResponse {
  MediaResult media = 1;
}

message UploadImagesRequest {
  MediaType type = 1;          // тип медиа
  string entity_id = 2;        // id сущности (product_id, group_id и т.д.)
  repeated  bytes data = 3;
}

message UploadImagesResponse {
  bool success = 1;
  repeated string errors = 2;  // ошибки для отдельных изображений
}

// запрос на удаление медиа
message DeleteMediaRequest {
  string media_id = 1;         // id медиа для удаления
}

message DeleteMediaResponse {
  bool success = 1;
}

// пакетное удаление
message DeleteMediaBatchRequest {
  repeated string media_ids = 1;
}

message DeleteMediaBatchResponse {
  int32 deleted_count = 1;
  repeated string failed_ids = 2;
}

// получение медиа по id
message GetMediaRequest {
  string media_id = 1;
}

message GetMediaResponse {
  MediaResult media = 1;
}

// получение медиа по entity_id (например все фото товара)
message GetMediaByEntityRequest {
  MediaType type = 1;
  string entity_id = 2;
}

message GetMediaByEntityResponse {
  repeated MediaResult media = 1;
}


// результат загрузки медиа
message MediaResult {
  string id = 1;               // уникальный id медиа
  MediaType type = 2;          // тип медиа
  ImageInfo thumbnail = 3;     // превью
  ImageInfo original = 4;      // оригинал
  string created_at = 5;       // время создания
}


// типы медиа контента
enum MediaType {
  MEDIA_TYPE_UNSPECIFIED = 0;
  //первое изображение товара
  MEDIA_TYPE_PRODUCT_ONE_IMAGE= 1;      
  //фото товара
  MEDIA_TYPE_PRODUCT = 2;      
  //фото категории/группы
  MEDIA_TYPE_GROUP = 3;   
  //сторис
  MEDIA_TYPE_STORY = 4;      
  //рекламный баннер
  MEDIA_TYPE_BANNER = 5;   
}


// информация о загруженном изображении
message ImageInfo {
  string url = 1;              // публичный url
  string key = 2;              // ключ в s3
}