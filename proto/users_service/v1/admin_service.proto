syntax = "proto3";

package users_service.v1;

option go_package = "github.com/kalina-malina/IM-PROTOS/generated/users_service/v1";

import "users_service/v1/user.proto";
import "common/types.proto";

service AdminService {

  // ============================================================================
  // ЗАЩИЩЕННЫЕ МЕТОДЫ - АДМИН
  // ============================================================================
  
  // Получение списка всех пользователей
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
  
  // Получение информации о пользователе по ID
  rpc GetUserById(GetUserByIdRequest) returns (GetUserByIdResponse);
  
  // Создание админа/оператора/менеджера супер-админом
  rpc CreateStaffUser(CreateStaffUserRequest) returns (CreateStaffUserResponse);
  
  // Блокировка пользователя
  rpc BanUser(BanUserRequest) returns (BanUserResponse);
  
  // Разблокировка пользователя
  rpc UnbanUser(UnbanUserRequest) returns (UnbanUserResponse);
  
  // Назначение временного пароля для клиента
  rpc SetTemporaryPassword(SetTemporaryPasswordRequest) returns (SetTemporaryPasswordResponse);
  
  // Изменение роли пользователя
  rpc ChangeUserRole(ChangeUserRoleRequest) returns (ChangeUserRoleResponse);
  
}

// ============================================================================
// АДМИНИСТРАТИВНЫЕ МЕТОДЫ
// ============================================================================

message ListUsersRequest {
  int32 page = 1;                     // Страница
  int32 limit = 2;                    // Количество на странице
  string search = 3;                  // Поисковый запрос
  string sort_by = 4;                 // Поле сортировки
  string order = 5;                   // Порядок (asc/desc)
  UserRole role_filter = 6;           // Фильтр по роли
  UserStatus status_filter = 7;       // Фильтр по статусу
  string created_from = 8;            // Дата создания от
  string created_to = 9;              // Дата создания до
}

message ListUsersResponse {
  repeated User users = 1;            // Список пользователей
  int32 total = 2;                    // Общее количество
  int32 page = 3;                     // Текущая страница
  int32 limit = 4;                    // Количество на странице
}

message GetUserByIdRequest {
  uint64 id_user = 1;                 // ID пользователя
}

message GetUserByIdResponse {
  User user = 1;                      // Информация о пользователе
}

message CreateStaffUserRequest {
  string email = 1;                   // Email
  string password = 2;                // Пароль
  string firstname = 3;               // Имя
  string lastname = 4;                // Фамилия
  string middlename = 5;              // Отчество
  UserRole role = 6;                  // Роль (админ/оператор/менеджер)
  uint64 phone = 7;                   // Телефон (опционально, числовой формат)
}

message CreateStaffUserResponse {
  User user = 1;                      // Созданный пользователь
}

message BanUserRequest {
  uint64 id_user = 1;                 // ID пользователя
  BanReason reason = 2;               // Причина блокировки
  string comment = 3;                 // Комментарий (опционально)
}

message BanUserResponse {
  bool success = 1;                   // Успешность операции
  User user = 2;                      // Обновленный пользователь
}

message UnbanUserRequest {
  uint64 id_user = 1;                 // ID пользователя
  string comment = 2;                 // Комментарий (опционально)
}

message UnbanUserResponse {
  bool success = 1;                   // Успешность операции
  User user = 2;                      // Обновленный пользователь
}

message SetTemporaryPasswordRequest {
  uint64 id_user = 1;                 // ID пользователя (клиента)
  string temp_password = 2;           // Временный пароль (генерируется автоматически если пустой)
  int32 expires_in_minutes = 3;       // Срок действия в минутах (по умолчанию 30)
}

message SetTemporaryPasswordResponse {
  bool success = 1;                   // Успешность операции
  string temp_password = 2;           // Временный пароль
  common.Timestamp expires_at = 3;    // Дата истечения
}

message ChangeUserRoleRequest {
  uint64 id_user = 1;                 // ID пользователя
  UserRole new_role = 2;              // Новая роль
}

message ChangeUserRoleResponse {
  bool success = 1;                   // Успешность операции
  User user = 2;                      // Обновленный пользователь
}

